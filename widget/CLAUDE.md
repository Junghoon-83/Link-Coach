# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Link-Coach Widget is an embeddable React application that provides AI-powered leadership coaching using Google Gemini API via Netlify Serverless Functions.

## Development Commands

### Local Development
```bash
npm run dev          # Start Vite dev server (localhost:5173)
netlify dev          # Start Netlify dev server with functions (localhost:8888)
```

### Building and Deployment
```bash
npm run build        # Build for production (outputs to dist/)
netlify deploy       # Deploy to Netlify preview
netlify deploy --prod  # Deploy to production
```

### Code Quality
```bash
npm run lint         # Run ESLint
npm run format       # Format with Prettier
```

## Architecture

### Frontend-Backend Split
- **Frontend**: React 18 + Vite (embedded widget)
- **Backend**: Netlify Serverless Functions (not FastAPI anymore)
- **AI**: Google Gemini 2.5 Flash via `@google/generative-ai` SDK

### Key Architectural Decisions

**Netlify Functions vs FastAPI Backend**
- Originally designed for FastAPI backend (see README.md)
- Current implementation uses Netlify Serverless Functions in `netlify/functions/`
- Functions use CommonJS (`.cjs` extension) due to `"type": "module"` in package.json
- API base URL defaults to `/.netlify/functions` (not `http://localhost:8000`)

**PostMessage Communication**
- Widget designed to be embedded via iframe in parent site
- Uses `window.postMessage` for initialization (see App.jsx:11-43)
- Demo mode auto-initializes with dummy data after 500ms for standalone testing

### Component Structure

```
App.jsx (Root)
  └── Widget.jsx (Main container)
      ├── ReportViewer.jsx (Leadership analysis report - dummy data)
      └── ChatInterface.jsx (AI chat with Gemini API)
```

**Data Flow:**
1. Parent site sends `INIT_WIDGET` message with token + user data
2. Widget stores auth token in sessionStorage
3. Widget displays:
   - Report tab: Static dummy data (NOT generated by AI)
   - Chat tab: Real-time Gemini API conversation

### API Integration (services/api.js)

```javascript
// Base URL resolution
const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || '/.netlify/functions'
```

**IMPORTANT**: Do not set `VITE_API_BASE_URL` in production `.env` file. It should use Netlify Functions by default.

## Netlify Functions

Located in `netlify/functions/` (NOT `server/`):

### chat.cjs
- **Purpose**: Real-time AI coaching chat
- **Model**: `gemini-2.5-flash`
- **Input**: `{ question, conversationHistory }`
- **Output**: `{ answer }`
- **System Prompt**: Configured for "개별비전형" (Individual-Vision) leadership style for user "지영 리더님"

### generate.cjs
- **Purpose**: Generate leadership analysis reports (currently unused - widget shows dummy data)
- **Model**: `gemini-2.0-flash-exp`
- **Input**: `{ user_id, leadership_type }`

### Function Requirements
- Must use CommonJS syntax: `exports.handler = async (event) => {}`
- Must use `.cjs` extension (package.json has `"type": "module"`)
- Require GEMINI_API_KEY environment variable in Netlify

## Environment Variables

### Required in Netlify Dashboard
```
GEMINI_API_KEY=<your-google-gemini-api-key>
```

### DO NOT Set in .env (causes CORS issues)
```
# VITE_API_BASE_URL=http://localhost:8000  # ❌ Breaks production
```

## Styling System

- Single CSS file: `src/styles/widget.css`
- Design system: "Link-Lite" premium glass morphism style
- CSS custom properties for colors, spacing, typography
- Responsive breakpoints: 768px (tablet), 480px (mobile)
- Key colors: `--accent-500: #6d28d9`, `--accent-600: #5b21b6`

## Common Issues

### "Network Error" or CORS Issues
- Check if `VITE_API_BASE_URL` is set in `.env` (should NOT be set)
- Verify `GEMINI_API_KEY` is configured in Netlify environment variables
- Run `netlify env:list` to check environment variables

### "API key not valid" Error
- Update API key: `netlify env:set GEMINI_API_KEY "your-key"`
- Redeploy after updating: `netlify deploy --prod`

### CommonJS/ESM Errors
- Netlify Functions must use `.cjs` extension
- Use `require()` and `exports.handler`, not `import`/`export`

## Demo vs Production Mode

**Demo Mode** (standalone widget):
- Auto-initializes after 500ms with dummy user data
- User: "지영 리더님", Type: "개별비전형"
- No parent postMessage communication needed

**Production Mode** (embedded):
- Waits for parent site's `INIT_WIDGET` message
- Requires valid JWT token and user data
- Currently not implemented on parent site

## GitHub Repository
https://github.com/Junghoon-83/Link-Coach

## Production URL
https://link-coach.netlify.app

## Future Planned Architecture

README.md describes a FastAPI backend with PostgreSQL and ChromaDB. This is NOT currently implemented. Current architecture:
- ❌ FastAPI server
- ❌ PostgreSQL database
- ❌ ChromaDB vector database
- ✅ Netlify Serverless Functions
- ✅ Gemini API direct integration
- ✅ Client-side state management only
